<html>
<head>
    <link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/styles/arduino-light.min.css">
    <script src="//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.8.0/highlight.min.js"></script>
    <script src="//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/languages/arduino.min.js"></script>
    <script>hljs.initHighlightingOnLoad();</script>
    <title>PS70: Intro to Digital Fabrication</title>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <link rel="stylesheet" href="style.css">
    <link rel="stylesheet" href="https://fonts.googleapis.com/icon?family=Material+Icons">
    <script src="js/customComponents.js"></script>
</head>

<body>
    <div id="navbar">
        <nav>
            <a class="secondary-colored" href="./index.html"><span class="primary-colored">01. </span>Home</a>
            <a class="secondary-colored" href="./about.html"><span class="primary-colored">02. </span>About</a>
            <a class="secondary-colored" href="./finalProject.html"><span class="primary-colored">03. </span>Final Project</a>
        </nav>
    </div>
    <div class="section">
        <div id="final">
            <h2><span class="primary-colored">Week 10. </span><span class="secondary-colored">Machine Building and End Effectors</span></h2>
            <div class="section-content">
                <div id="projectDetails">
                    <div class="vertical-tab">
                        <button class="verticaltablinks active"
                            onclick="openTab(event, 'finaltab1', 'vertical')"
                            style="border-top-left-radius: 10px;">Drawing Machine</button>
                        <button class="verticaltablinks"
                            onclick="openTab(event, 'finaltab2', 'vertical')">Video</button>
                        <button class="verticaltablinks"
                            onclick="openTab(event, 'finaltab3', 'vertical')">Code</button>
                    </div>
                    <div id="finaltab1" class="verticaltabcontent default-focus" style="display: block; opacity: 1; position: relative;">
                        <h3>Group project: Drawing Machine (Aurora, Ben, PhannyPacc, Xavier)</h3>
                        <h5 class="range"><video id="smalljpg" style="float:left" controls autoplay muted><source src="wk10media/drawingMachine1.mp4" type="video/mp4"></video>We really like how <a target="_blank" href="https://ctian5136.github.io/ps70portfolio/html/weeks/finalproject.html" class="tertiary-colored">Cindy's drawing machine</a> looked, so we went through her website and from there found <a target="_blank" href="https://andrewsleigh.github.io/plotter/" class="tertiary-colored">the site</a> that she based her machine on. There were 3D print files for the Cartesian plotter version of drawing machine on this website, so we decided to print those parts and use that model for our machine. The first time that we printed the parts, the print failed in the middle of the print BUT we happened to have printed two of each part. Because the parts are not completely symmetrical in the direction in which the print stopped, the two “halves” of the failed print sort of fit together but needed modifications to fit the metal dowels and motors and screws etc. so we drilled some holes and sawed some parts off to make all the parts work. Using these, we were able to do some preliminary testing of the fit of the motors in the 3D print parts and better visualize how everything would fit together.</h5>
                        <h5 class="range"><img src="wk10media/drawingMachine1.jpg" alt="single motor circuit" id="headshot" style="float: right">Luckily for our group, PhannyPacc already had a stepper motor setup and code from previous work on her final project, so we used that as a starting point for the motors for our drawing machine. This code allowed us to control the motor using a button so that pressing the button would cause the motor to spin for a 10 second interval. We were initially using two stepper motors that looked kinda run down and were not working with PhannyPacc’s code/exact same setup, but after testing a bunch of different motors, we finally got two that worked. We then set up a second motor using the same circuitry as the first one and modified the Arduino code so that there could be two motors running at the same time each with their own button control.</h5>
                        <h5 class="range"><img src="wk10media/drawingMachine2.jpg" alt="bill of materials collected" id="smalljpg" style="float:left">We collected all of the parts listed on the bill of materials from the plotter website. There weren’t any explicit instructions on how to assemble the machine, and it turned out this list of materials was most likely for a different version of the plotter so we ended up only using some of these materials and figuring out what other parts we could use by guessing based on the photos on the site (but the setup with all the little things in cups looked nice so here’s a photo).</h5>
                        <h5 class="range">After experimenting with a variety of different little parts and continuing to guess what was going on inside of the closed machine parts from the plotter photos, we managed to figure out a way to make the middle moving gantry piece of the machine hopefully work correctly, although we could not find enough linear bearings for the larger metal dowels (so this part of the machine is not super stable). We attached one of the stepper motors to the top half of the gantry and then lined up a timer pulley on the motor with two timer pulleys that we made stationary with lock nuts to create tension on the pulley belt and then tried running the attached motor with the pulley system to see if the top gantry would move and IT WORKED :D</h5>
                        <h5 class="range" style="text-align:center"><img src="wk10media/drawingMachine4.jpg" alt="top half of gantry" id="headshot"><video id="headshot" controls autoplay muted><source src="wk10media/drawingMachine2.mp4" type="video/mp4"></video></h5>
                        <h5 class="range">We ended up reprinting the 3D print parts and the print did not fail this time (yay) so we could use the actual original parts to create our machine. The machine was magically put together using these reprinted parts (most likely by Ben the god) and mounted to a wooden board with extra pieces of wood (bracket supports) underneath the end pieces of the machine because the stepper motors we are using are slightly taller than the 3D printed parts. We used zip ties to secure the pulley belts, and have countersunk holes in the wooden platform for screws so that the platform will sit flat on the table.</h5>
                        <h5 class="range" style="text-align:center"><img src="wk10media/drawingMachine5.jpg" alt="fully printed 3D parts" id="headshot"><img src="wk10media/drawingMachine6.png" alt="fully wooden base with bracket supports" id="headshot"><img src="wk10media/drawingMachine7.png" alt="countersunk holes in wodden platform" id="headshot"><img src="wk10media/drawingMachine8.png" alt="machine put together!" id="headshot"></h5>
                        <h5 class="range">We then combined the motor circuits and the machine we built to start figuring out how we would get the machine moving. The motors were being a bit finicky, so in our initial test, only the movement along the larger metal dowels was working. The code was still using a timer to control the directionality of the motor, so once the gantry reached one end of the dowels, it would just get stuck there for a bit before changing direction, but it still moved so yay!</h5>
                        <h5 class="range" style="text-align:center"><video id="headshot" controls autoplay muted><source src="wk10media/drawingMachine3.mp4" type="video/mp4"></video></h5>
                        <h5 class="range">After fiddling around a bit with the motors, we got them to work simultaneously. However, the movement along the smaller dowels was not very smooth because the motor seemed to be moving in choppier steps and once the gantry got closer to one end or the other of the dowels, the machine would be tilting a bit because there was no support on either end of the smaller dowels. The pulley belt also did not have enough tension, which made the movement more variable, and it was also not super stable due to the missing two linear bearings.</h5>
                        <h5 class="range" style="text-align:center"><video id="headshot" controls autoplay muted><source src="wk10media/drawingMachine4.mp4" type="video/mp4"></video><img src="wk10media/drawingMachine9.png" alt="only two linear bearings..." id="headshot"></h5>
                        <h5 class="range">To fix the tilting issue at full extension of the smaller dowels, we needed something on the non-pen end of the smaller dowels that would support the machine and counterbalance the increased weight when at full extension. The support also needed to be able to freely roll around on the table top so that the drawing side of the machine could also still move freely. We decided on using a ball-bearing roller with a weight on top to function as this counterbalance support. This seemed to do the job and prevent the tilt of the dowels at the full extension point.</h5>
                        <h5 class="range" style="text-align:center"><img src="wk10media/drawingMachine10.png" alt="tilting at full extension" id="headshot"><img src="wk10media/drawingMachine11.png" alt="no more tilt!" id="headshot"><img src="wk10media/drawingMachine12.png" alt="ball-bearing roller and weight support" id="headshot"></h5>
                        <h5 class="range">To fix the issue with the shaky motor movement, Nathan suggested cleaning up all of the wiring of our motor circuits, and we increased the tension on the pulley belts. Once we cleaned up the circuitry, the motors stopped working entirely (because Aurora messed it up because she took out a very important wire that connected the two ends of the weird breadboard together because she thought we didn’t need that wire because she didn’t know the two ends of the breadboard were not already connected to each other…..). We asked Bobby for help and he figured out that the issue was that the motor drivers were not getting the 5 volts from the arduino (because of that extra wire) and when he tried to fix it, one of the motor drivers EXPLODED INTO FLAMES (oopsies).</h5>
                        <h5 class="range" style="text-align:center"><img src="wk10media/drawingMachine13.jpg" alt="normal vs post-explosion motor drivers" id="headshot"></h5>
                        <h5 class="range">But yay, the issue was identified and Bobby got us a new breadboard where the two ends were already pre-connected and once everything was transferred over to this new breadboard and the pulleys were taut, we tested the machine out and IT WORKED – both motors could be controlled by buttons, could move simultaneously, and moved relatively smoothly.</h5>
                        <h5 class="range" style="text-align:center"><video id="headshot" controls autoplay muted><source src="wk10media/drawingMachine5.mp4" type="video/mp4"></video><img src="wk10media/drawingMachine14.jpg" alt="insides of top and bottom gantry" id="headshot"><img src="wk10media/drawingMachine15.jpg" alt="before gantry re-assembly, after fixing pulley belts" id="headshot"></h5>
                        <h5 class="range">Unfortunately, the 3D printed parts are not super strong, so in an attempt to fix the pulley belts, we broke the gantry parts and had to last minute reprint them (which was quite unfortunate because the print times are suuuuuper long).</h5>
                        <h5 class="range" style="text-align:center"><img src="wk10media/drawingMachine16.png" alt="gantry broke :(" id="headshot"></h5>
                        <h5 class="range">Once the parts finished printing, we were able to put everything back together and attach a pen (ended up using some tape to make it more stable). Before drawing a circle, we got the drawing machine to draw a square. This code used equivalent accelerations for both the x and y axis drawing, which creates straight lines.</h5>
                        <h5 class="range" style="text-align:center"><video id="headshot" controls autoplay muted><source src="wk10media/drawingMachineSquare.mp4" type="video/mp4"></video></h5>
                        <h5 class="range">To get the machine to draw curved lines, we had to change the code so that the accelerations and max speeds for the x and y axes were different. Bobby helped us figure this out, and we ended up with a "circle" (kinda...mix between circle and square).</h5>
                        <h5 class="range" style="text-align:center"><img src="wk10media/drawingCircle4.jpg" alt="test circles" id="smalljpg"><img src="wk10media/drawingCircle3.jpg" alt="test circles" id="smalljpg"><img src="wk10media/drawingCircle2.jpg" alt="test circles" id="smalljpg"><img src="wk10media/drawingCircle1.jpg" alt="test circles" id="smalljpg"></h5>
                    </div>
                    <div id="finaltab2" class="verticaltabcontent">
                        <h3>Best videos of machine at this point...</h3>
                        <video style="max-width:100%; height:auto; margin: 10px"controls autoplay muted><source src="wk10media/drawingMachineCircleish1.mp4" type="video/mp4"></video>
                        <video style="max-width:100%; height:auto; margin: 10px"controls autoplay muted><source src="wk10media/drawingMachineCircleish2.mp4" type="video/mp4"></video>
                    </div>
                    <div id="finaltab3" class="verticaltabcontent">
                        <h3>Arduino Code</h3>
                        <pre><code>#include &lt;AccelStepper.h&gt;
#include &lt;Servo.h&gt;


// Define stepper motor connections and steps per revolution
#define stepsPerRevolution 200
int up_angle = 130;
int down_angle = 180;


// Create a new AccelStepper object
AccelStepper stepper_xaxis(AccelStepper::DRIVER, 10, 9);
AccelStepper stepper_yaxis(AccelStepper::DRIVER, 13, 12);


Servo myservo;  // create servo object to control a servo

// float speed_x = abs(sin(millis()/1000));
// float speed_y = abs(cos(millis()/1000));

void setup() {
  // Set maximum speed and acceleration
  stepper_xaxis.setMaxSpeed(400);
  stepper_xaxis.setAcceleration(40);
  stepper_yaxis.setMaxSpeed(400);
  stepper_yaxis.setAcceleration(20);


  myservo.attach(2);  // attaches the servo on pin 9 to the servo object
  myservo.write(up_angle);
}


void loop() {


  myservo.write(down_angle);


  // PHASE 1
  stepper_xaxis.moveTo(1.5*stepsPerRevolution);
  stepper_yaxis.moveTo(1.5*stepsPerRevolution);
  while(stepper_xaxis.distanceToGo() != 0 || stepper_yaxis.distanceToGo() != 0) {
    
    if(stepper_xaxis.distanceToGo() != 0) {
      stepper_xaxis.run();
    }
    if(stepper_yaxis.distanceToGo() != 0) {
      stepper_yaxis.run();
    }
  }

  // switch acceleration to curve in other direction
  if(stepper_xaxis.acceleration() == 20){
    stepper_xaxis.setAcceleration(40);
    stepper_yaxis.setAcceleration(20);
  }
  else{
    stepper_yaxis.setAcceleration(40);
    stepper_xaxis.setAcceleration(20);
  }
  stepper_xaxis.setCurrentPosition(0);
  stepper_yaxis.setCurrentPosition(0);


  myservo.write(up_angle);


  delay(1000);


  myservo.write(down_angle);


  // PHASE 2
  stepper_xaxis.moveTo(-1.5*stepsPerRevolution);
  stepper_yaxis.moveTo(1.5*stepsPerRevolution);
  while(stepper_xaxis.distanceToGo() != 0 || stepper_yaxis.distanceToGo() != 0) {
    if(stepper_xaxis.distanceToGo() != 0) {
      stepper_xaxis.run();
    }
    if(stepper_yaxis.distanceToGo() != 0) {
      stepper_yaxis.run();
    }
  }

  // switch acceleration to curve in other direction
  if(stepper_xaxis.acceleration() == 20){
    stepper_xaxis.setAcceleration(40);
    stepper_yaxis.setAcceleration(20);
  }
  else{
    stepper_yaxis.setAcceleration(40);
    stepper_xaxis.setAcceleration(20);
  }
  stepper_xaxis.setCurrentPosition(0);
  stepper_yaxis.setCurrentPosition(0);
  
  myservo.write(up_angle);


  delay(1000);


  myservo.write(down_angle);


  // PHASE 3
  stepper_xaxis.moveTo(-1.5*stepsPerRevolution);
  stepper_yaxis.moveTo(-1.5*stepsPerRevolution);
  while(stepper_xaxis.distanceToGo() != 0 || stepper_yaxis.distanceToGo() != 0) {
    if(stepper_xaxis.distanceToGo() != 0) {
      stepper_xaxis.run();
    }
    if(stepper_yaxis.distanceToGo() != 0) {
      stepper_yaxis.run();
    }
  }

  // switch acceleration to curve in other direction
  if(stepper_xaxis.acceleration() == 20){
    stepper_xaxis.setAcceleration(40);
    stepper_yaxis.setAcceleration(20);
  }
  else{
    stepper_yaxis.setAcceleration(40);
    stepper_xaxis.setAcceleration(20);
  }
  stepper_xaxis.setCurrentPosition(0);
  stepper_yaxis.setCurrentPosition(0);


  myservo.write(up_angle);


  delay(1000);


  myservo.write(down_angle);


  // PHASE 4
  stepper_xaxis.moveTo(1.5*stepsPerRevolution);
  stepper_yaxis.moveTo(-1.5*stepsPerRevolution);
  while(stepper_xaxis.distanceToGo() != 0 || stepper_yaxis.distanceToGo() != 0) {
    if(stepper_xaxis.distanceToGo() != 0) {
      stepper_xaxis.run();
    }
    if(stepper_yaxis.distanceToGo() != 0) {
      stepper_yaxis.run();
    }
  }

  // switch acceleration to curve in other direction
  if(stepper_xaxis.acceleration() == 20){
    stepper_xaxis.setAcceleration(40);
    stepper_yaxis.setAcceleration(20);
  }
  else{
    stepper_yaxis.setAcceleration(40);
    stepper_xaxis.setAcceleration(20);
  }
  stepper_xaxis.setCurrentPosition(0);
  stepper_yaxis.setCurrentPosition(0);


  myservo.write(up_angle);


  delay(1000);
}</code></pre>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        function openTab(evt, id, type) {
            var i, tabcontent, tablinks, hgt;
            if (type == "horizontal"){
                tabcontent = document.getElementsByClassName("tabcontent");
                tablinks = document.getElementsByClassName("tablinks");
                hgt = "75%";
            } else if (type == "vertical"){
                tabcontent = document.getElementsByClassName("verticaltabcontent");
                tablinks = document.getElementsByClassName("verticaltablinks");
                hgt = "87.5%";
            }

            for (i = 0; i < tabcontent.length; i++) {
                tabcontent[i].style.opacity = "0";
                tabcontent[i].style.height = "0";
                tabcontent[i].style.position = "absolute";
                tabcontent[i].style.transform = "translateY(-3px)";
            }

            for (i = 0; i < tablinks.length; i++) {
                tablinks[i].classList.remove("active");
            }

            var selectedTab = document.getElementById(id);
            selectedTab.style.height = hgt;
            selectedTab.style.position = "relative";
            selectedTab.style.opacity = "1";
            selectedTab.style.transform = "translateY(0px)";
            selectedTab.style.transition = "opacity 0.5s ease-in, transform 0.8s ease-in-out";
            
            evt.currentTarget.classList.add("active");
        }
    </script>
</body>

</html>